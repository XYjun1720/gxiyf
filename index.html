<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>精灵表GIF生成器 - 在线动画制作工具</title>
    <meta name="description" content="免费在线精灵表分割工具，一键生成GIF动画。支持帧编辑、批量处理和透明背景。">
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 谷歌字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎞️</text></svg>">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header>
            <h1><i class="fas fa-film"></i> 精灵表GIF生成器</h1>
            <p class="subtitle">上传精灵表 → 分割成帧 → 生成动画 → 一键下载</p>
            <div class="header-tips">
                <span class="tip"><i class="fas fa-lightbulb"></i> 支持PNG、JPG、GIF格式</span>
                <span class="tip"><i class="fas fa-lightbulb"></i> 完全在浏览器中处理，不上传服务器</span>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main>
            <!-- 左侧：控制面板 -->
            <div class="control-panel">
                <!-- 上传区域 -->
                <div class="card upload-section">
                    <h3><i class="fas fa-cloud-upload-alt"></i> 上传图像</h3>
                    <div class="upload-area" id="uploadArea" title="点击或拖放文件到这里">
                        <i class="fas fa-file-upload"></i>
                        <p><strong>选择精灵表图像</strong></p>
                        <p class="upload-hint">支持 PNG, JPG, GIF 格式</p>
                        <input type="file" id="spriteInput" accept="image/*">
                        <div class="upload-buttons">
                            <button class="btn small" onclick="document.getElementById('spriteInput').click()">
                                <i class="fas fa-folder-open"></i> 选择文件
                            </button>
                            <button class="btn small secondary" id="sampleBtn">
                                <i class="fas fa-magic"></i> 使用示例
                            </button>
                        </div>
                    </div>
                    <div class="upload-options">
                        <label class="option">
                            <input type="checkbox" id="batchMode">
                            <span>批量模式</span>
                            <small>一次上传多张图片</small>
                        </label>
                        <input type="file" id="batchInput" accept="image/*" multiple style="display:none;">
                    </div>
                    <div class="file-info" id="fileInfo">
                        <div class="info-item">
                            <span>状态：</span>
                            <span class="status" id="fileStatus">等待上传</span>
                        </div>
                    </div>
                </div>

                <!-- 分割设置 -->
                <div class="card settings-section">
                    <h3><i class="fas fa-crop-alt"></i> 分割设置</h3>
                    <div class="settings-grid">
                        <div class="form-group">
                            <label for="rows"><i class="fas fa-grip-lines"></i> 行数</label>
                            <div class="input-with-buttons">
                                <button class="num-btn minus" data-target="rows">-</button>
                                <input type="number" id="rows" min="1" max="20" value="1">
                                <button class="num-btn plus" data-target="rows">+</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cols"><i class="fas fa-grip-lines-vertical"></i> 列数</label>
                            <div class="input-with-buttons">
                                <button class="num-btn minus" data-target="cols">-</button>
                                <input type="number" id="cols" min="1" max="20" value="1">
                                <button class="num-btn plus" data-target="cols">+</button>
                            </div>
                        </div>
                    </div>
                    <button id="autoDetectBtn" class="btn secondary">
                        <i class="fas fa-robot"></i> 自动检测网格
                    </button>
                    
                    <div class="divider"></div>
                    
                    <h3><i class="fas fa-sliders-h"></i> 动画设置</h3>
                    <div class="form-group">
                        <label for="frameDelay">
                            <i class="fas fa-clock"></i> 帧延迟
                            <span class="value-display" id="delayValue">100ms</span>
                        </label>
                        <input type="range" id="frameDelay" min="20" max="500" value="100">
                        <div class="range-labels">
                            <span>快</span>
                            <span>慢</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="playbackSpeed">
                            <i class="fas fa-tachometer-alt"></i> 播放速度
                        </label>
                        <div class="speed-buttons">
                            <button class="speed-btn" data-speed="0.5">0.5x</button>
                            <button class="speed-btn active" data-speed="1">1x</button>
                            <button class="speed-btn" data-speed="2">2x</button>
                            <button class="speed-btn" data-speed="3">3x</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="bgColor">
                            <i class="fas fa-fill-drip"></i> 背景颜色
                        </label>
                        <select id="bgColor">
                            <option value="transparent">透明背景</option>
                            <option value="white">白色</option>
                            <option value="black">黑色</option>
                            <option value="#f0f0f0">浅灰色</option>
                            <option value="#e3f2fd">淡蓝色</option>
                        </select>
                    </div>
                </div>

                <!-- 动作按钮 -->
                <div class="card action-section">
                    <h3><i class="fas fa-play-circle"></i> 生成与控制</h3>
                    <div class="button-group">
                        <button id="generateBtn" class="btn primary">
                            <i class="fas fa-play"></i> 生成GIF动画
                        </button>
                        <button id="saveBtn" class="btn success" disabled>
                            <i class="fas fa-download"></i> 下载GIF文件
                        </button>
                        <button id="resetBtn" class="btn warning">
                            <i class="fas fa-redo"></i> 重置所有
                        </button>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>生成进度</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="progress-bar" id="progressBar"></div>
                        <div class="progress-text" id="progressText">准备就绪</div>
                    </div>
                    
                    <div class="quick-actions">
                        <h4><i class="fas fa-bolt"></i> 快速操作</h4>
                        <div class="quick-buttons">
                            <button class="quick-btn" data-action="reverse">
                                <i class="fas fa-exchange-alt"></i> 反向
                            </button>
                            <button class="quick-btn" data-action="duplicate">
                                <i class="fas fa-copy"></i> 复制
                            </button>
                            <button class="quick-btn" data-action="remove">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 预设效果 -->
                <div class="card presets-section">
                    <h3><i class="fas fa-star"></i> 预设效果</h3>
                    <p class="section-description">一键应用动画效果</p>
                    <div class="preset-buttons">
                        <button class="preset-btn" data-effect="blink">
                            <i class="fas fa-lightbulb"></i> 闪烁
                        </button>
                        <button class="preset-btn" data-effect="bounce">
                            <i class="fas fa-basketball-ball"></i> 弹跳
                        </button>
                        <button class="preset-btn" data-effect="fade">
                            <i class="fas fa-wave-square"></i> 淡入淡出
                        </button>
                        <button class="preset-btn" data-effect="shake">
                            <i class="fas fa-shake"></i> 抖动
                        </button>
                        <button class="preset-btn" data-effect="zoom">
                            <i class="fas fa-search-plus"></i> 缩放
                        </button>
                        <button class="preset-btn" data-effect="slide">
                            <i class="fas fa-arrows-alt-h"></i> 滑动
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右侧：预览和编辑区域 -->
            <div class="preview-panel">
                <!-- 预览区域 -->
                <div class="card preview-section">
                    <h3><i class="fas fa-eye"></i> 预览</h3>
                    <div class="preview-container">
                        <div class="original-preview">
                            <div class="preview-header">
                                <h4><i class="fas fa-image"></i> 原始图像</h4>
                                <div class="preview-stats" id="originalStats">未加载</div>
                            </div>
                            <div class="canvas-container">
                                <canvas id="originalCanvas"></canvas>
                                <div class="grid-overlay" id="gridOverlay"></div>
                            </div>
                            <div class="preview-controls">
                                <button class="btn small" id="zoomInBtn">
                                    <i class="fas fa-search-plus"></i>
                                </button>
                                <button class="btn small" id="zoomOutBtn">
                                    <i class="fas fa-search-minus"></i>
                                </button>
                                <button class="btn small" id="fitCanvasBtn">
                                    <i class="fas fa-expand-alt"></i> 适应
                                </button>
                            </div>
                        </div>
                        
                        <div class="gif-preview">
                            <div class="preview-header">
                                <h4><i class="fas fa-film"></i> GIF动画预览</h4>
                                <div class="preview-stats" id="gifStats">等待生成</div>
                            </div>
                            <div class="gif-container" id="gifContainer">
                                <div class="empty-state" id="emptyGif">
                                    <i class="fas fa-video fa-3x"></i>
                                    <p>生成的GIF将显示在这里</p>
                                </div>
                                <img id="gifOutput" style="display:none; max-width:100%;">
                            </div>
                            <div class="gif-controls">
                                <button id="playBtn" class="btn small" disabled>
                                    <i class="fas fa-play"></i> 播放
                                </button>
                                <button id="pauseBtn" class="btn small" disabled>
                                    <i class="fas fa-pause"></i> 暂停
                                </button>
                                <button id="stopBtn" class="btn small" disabled>
                                    <i class="fas fa-stop"></i> 停止
                                </button>
                                <button id="loopBtn" class="btn small active">
                                    <i class="fas fa-sync"></i> 循环
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 帧管理 -->
                <div class="card frames-section">
                    <div class="frames-header">
                        <h3><i class="fas fa-th-large"></i> 帧管理</h3>
                        <div class="frame-count" id="frameCount">0 帧</div>
                    </div>
                    <div class="frames-toolbar">
                        <button id="sortBtn" class="btn small">
                            <i class="fas fa-sort-amount-down"></i> 排序
                        </button>
                        <button id="reverseBtn" class="btn small">
                            <i class="fas fa-retweet"></i> 反转
                        </button>
                        <button id="clearFramesBtn" class="btn small">
                            <i class="fas fa-trash-alt"></i> 清空
                        </button>
                        <button id="addTextBtn" class="btn small">
                            <i class="fas fa-font"></i> 添加文字
                        </button>
                    </div>
                    <div class="frames-container" id="framesContainer">
                        <div class="empty-state" id="emptyFrames">
                            <i class="fas fa-th fa-3x"></i>
                            <p>分割后的帧将显示在这里</p>
                            <p class="hint">上传图像并设置行列数开始分割</p>
                        </div>
                    </div>
                    <div class="frames-footer">
                        <div class="drag-hint">
                            <i class="fas fa-arrows-alt"></i> 拖放帧可以重新排序
                        </div>
                    </div>
                </div>

                <!-- 帧编辑 -->
                <div class="card edit-section">
                    <h3><i class="fas fa-edit"></i> 帧编辑工具</h3>
                    <div class="edit-notice" id="editNotice">
                        <i class="fas fa-mouse-pointer"></i> 请先在上方选择一个帧进行编辑
                    </div>
                    <div class="edit-tools">
                        <button class="edit-btn" data-tool="rotate" title="旋转">
                            <i class="fas fa-redo"></i>
                            <span>旋转</span>
                        </button>
                        <button class="edit-btn" data-tool="crop" title="裁剪">
                            <i class="fas fa-crop"></i>
                            <span>裁剪</span>
                        </button>
                        <button class="edit-btn" data-tool="brightness" title="亮度">
                            <i class="fas fa-sun"></i>
                            <span>亮度</span>
                        </button>
                        <button class="edit-btn" data-tool="contrast" title="对比度">
                            <i class="fas fa-adjust"></i>
                            <span>对比度</span>
                        </button>
                        <button class="edit-btn" data-tool="flip" title="翻转">
                            <i class="fas fa-undo"></i>
                            <span>翻转</span>
                        </button>
                        <button class="edit-btn" data-tool="filter" title="滤镜">
                            <i class="fas fa-filter"></i>
                            <span>滤镜</span>
                        </button>
                    </div>
                    <div class="edit-controls" id="editControls" style="display:none;">
                        <!-- 编辑控件将在这里动态加载 -->
                    </div>
                    <div class="edit-history">
                        <button id="undoBtn" class="btn small" disabled>
                            <i class="fas fa-undo"></i> 撤销
                        </button>
                        <button id="redoBtn" class="btn small" disabled>
                            <i class="fas fa-redo"></i> 重做
                        </button>
                        <button id="applyEditBtn" class="btn small primary" style="display:none;">
                            <i class="fas fa-check"></i> 应用更改
                        </button>
                    </div>
                </div>

                <!-- 历史记录 -->
                <div class="card history-section">
                    <div class="history-header">
                        <h3><i class="fas fa-history"></i> 历史记录</h3>
                        <button id="clearHistoryBtn" class="btn small">
                            <i class="fas fa-trash"></i> 清除
                        </button>
                    </div>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <i class="fas fa-clock fa-3x"></i>
                            <p>暂无生成记录</p>
                            <p class="hint">生成的GIF将自动保存到这里</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 页脚 -->
        <footer>
            <div class="footer-content">
                <div class="footer-info">
                    <p>© 2023 精灵表GIF生成器 | 基于 HTML5 Canvas 和 JavaScript 构建</p>
                    <p class="footer-tips">
                        <i class="fas fa-exclamation-circle"></i>
                        提示：所有处理都在浏览器中完成，保护您的隐私安全
                    </p>
                </div>
                <div class="footer-links">
                    <a href="#" id="helpLink">
                        <i class="fas fa-question-circle"></i> 使用帮助
                    </a>
                    <a href="#" id="githubLink">
                        <i class="fab fa-github"></i> GitHub
                    </a>
                    <a href="#" id="feedbackLink">
                        <i class="fas fa-comment-dots"></i> 反馈建议
                    </a>
                    <a href="#" id="donateLink">
                        <i class="fas fa-coffee"></i> 支持开发者
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- 模态框：使用说明 -->
    <div class="modal" id="instructionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> 使用说明</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="instruction-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>上传图像</h3>
                        <p>点击上传区域选择精灵表图像，或直接拖放文件。</p>
                        <p class="tip">💡 精灵表应该是包含多个动画帧的网格图像。</p>
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>设置分割</h3>
                        <p>输入正确的行数和列数，或使用"自动检测网格"功能。</p>
                        <p class="tip">💡 预览区域会显示网格线，确保每帧都被正确分割。</p>
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>调整动画</h3>
                        <p>设置帧延迟（控制动画速度）和播放效果。</p>
                        <p class="tip">💡 延迟越小动画越快，建议100-200ms。</p>
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>生成下载</h3>
                        <p>点击"生成GIF"创建动画，完成后可下载到本地。</p>
                        <p class="tip">💡 生成时间取决于帧数和图像大小。</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn primary" id="startTutorialBtn">
                    <i class="fas fa-play"></i> 开始教程
                </button>
                <button class="btn secondary close-modal-btn">
                    <i class="fas fa-times"></i> 关闭
                </button>
            </div>
        </div>
    </div>

    <!-- 模态框：示例图像选择 -->
    <div class="modal" id="sampleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-images"></i> 选择示例图像</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="samples-grid">
                    <div class="sample-item" data-sample="run">
                        <img src="https://via.placeholder.com/150x100/3498db/ffffff?text=跑步动画" alt="跑步动画">
                        <p>跑步动画 (4x1)</p>
                    </div>
                    <div class="sample-item" data-sample="jump">
                        <img src="https://via.placeholder.com/150x100/2ecc71/ffffff?text=跳跃动画" alt="跳跃动画">
                        <p>跳跃动画 (4x1)</p>
                    </div>
                    <div class="sample-item" data-sample="attack">
                        <img src="https://via.placeholder.com/150x100/e74c3c/ffffff?text=攻击动画" alt="攻击动画">
                        <p>攻击动画 (3x1)</p>
                    </div>
                    <div class="sample-item" data-sample="character">
                        <img src="https://via.placeholder.com/150x100/9b59b6/ffffff?text=角色精灵" alt="角色精灵">
                        <p>角色精灵 (3x4)</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary close-modal-btn">
                    <i class="fas fa-times"></i> 取消
                </button>
            </div>
        </div>
    </div>

    <!-- 脚本引入 -->
    <!-- 注意：gif.js必须放在script.js之前 -->
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
